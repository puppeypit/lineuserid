<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</title>
  <style>
    body { font-family: 'Sarabun', sans-serif; background-color: #f4f6f9; padding: 20px; display: flex; justify-content: center; }
    .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
    .profile-img { width: 100px; height: 100px; border-radius: 50%; display: none; margin: 0 auto 15px auto; object-fit: cover; }
    .form-group { margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; color: #333;}
    input[type="text"] { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; }
    button { width: 100%; padding: 12px; background-color: #00B900; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; }
    button:disabled { background-color: #cccccc; cursor: not-allowed; }
    #statusMessage { margin-top: 15px; text-align: center; display: none; font-weight: bold; }
    .text-center { text-align: center; }
  </style>
</head>
<body>

  <div class="container">
    <div class="text-center">
      <img id="profileImage" class="profile-img" src="" alt="Profile Image">
      <h3 id="displayName" style="color:#555;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏£‡∏∞‡∏ö‡∏ö...</h3>
    </div>

    <form id="myForm" onsubmit="submitForm(event)">
      <div class="form-group">
        <label for="name">‡∏ä‡∏∑‡πà‡∏≠</label>
        <input type="text" id="name" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏™‡πà‡∏Ñ‡∏≥‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤)">
      </div>
      <div class="form-group">
        <label for="surname">‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
        <input type="text" id="surname" required placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
      </div>
      <button type="submit" id="submitBtn" disabled>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </form>

    <div id="statusMessage"></div>
  </div>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    let lineProfile = {};
    
    // üî¥ LIFF ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
    const LIFF_ID = "2009229714-1R09rohG"; 
    
    // üî¥ ‡∏ß‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå GAS (‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢ /exec) ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    const GAS_URL = "https://script.google.com/macros/s/AKfycbz_famQR3HTZkR8TKAKjZNYfvZ3PpVsJamulajhGmcWg_lJGeyzODMlfl1lITTXJTXB/exec"; 

    const displayElement = document.getElementById('displayName');

    window.onload = async function() {
      displayElement.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE...';
      try {
        await liff.init({ liffId: LIFF_ID });
        if (liff.isLoggedIn()) {
          const profile = await liff.getProfile();
          lineProfile = {
            userId: profile.userId,
            displayName: profile.displayName,
            language: liff.getLanguage() || 'th',
            pictureUrl: profile.pictureUrl || ''
          };
          
          displayElement.innerText = '‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏∏‡∏ì ' + profile.displayName;
          displayElement.style.color = '#00B900';
          
          if(profile.pictureUrl) {
            document.getElementById('profileImage').src = profile.pictureUrl;
            document.getElementById('profileImage').style.display = 'block';
          }
          
          document.getElementById('submitBtn').disabled = false;
        } else {
          liff.login();
        }
      } catch (err) {
        displayElement.innerText = '‡πÄ‡∏Å‡∏¥‡∏î Error: ' + err.message;
        displayElement.style.color = 'red';
      }
    };

    function submitForm(event) {
      event.preventDefault();
      const btn = document.getElementById('submitBtn');
      const statusDiv = document.getElementById('statusMessage');
      
      btn.disabled = true;
      btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
      statusDiv.style.display = 'none';

      // ‡∏à‡∏±‡∏î‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
      const data = {
        userId: lineProfile.userId,
        displayName: lineProfile.displayName,
        language: lineProfile.language,
        pictureUrl: lineProfile.pictureUrl,
        name: document.getElementById('name').value,
        surname: document.getElementById('surname').value
      };

      // ‡πÅ‡∏õ‡∏•‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏≤‡∏£‡∏≤‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏ï‡πà‡∏≠‡∏ó‡πâ‡∏≤‡∏¢ URL
      const params = new URLSearchParams(data).toString();
      const finalUrl = GAS_URL + "?" + params;

      // ‡∏ó‡πà‡∏≤‡πÑ‡∏°‡πâ‡∏ï‡∏≤‡∏¢‡∏ó‡∏∞‡∏•‡∏ß‡∏á CORS: ‡∏™‡πà‡∏á‡πÅ‡∏ö‡∏ö GET ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡πÇ‡∏´‡∏°‡∏î no-cors
      fetch(finalUrl, {
        method: 'GET',
        mode: 'no-cors'
      })
      .then(() => {
        // ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ no-cors ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏≠‡πà‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‡πÄ‡∏£‡∏≤‡∏à‡∏∂‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡∏™‡πÄ‡∏ï‡πá‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡πá‡∏Ñ‡πÑ‡∏õ‡πÄ‡∏•‡∏¢
        statusDiv.style.display = 'block';
        statusDiv.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß';
        statusDiv.style.color = '#00B900';
        
        // ‡∏£‡∏≠ 2 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á LIFF
        setTimeout(() => { liff.closeWindow(); }, 2000); 
      })
      .catch(error => {
        statusDiv.style.display = 'block';
        statusDiv.innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
        statusDiv.style.color = 'red';
        btn.disabled = false;
        btn.innerText = '‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á';
      });
    }
  </script>
</body>
</html>